
@{
    ViewBag.Header = "Trend Analysis";
    ViewBag.Section = "Analytics";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    tr {
        height: 50px;
    }

    td {
        width: 250px;
    }

    select {
        width: 200px;
        padding-right: 20px;
    }

    th {
        text-align: right;
        width: 200px;
    }

    button {
        width: 150px;
    }
    #chart-container{
        width:100%;
        height:500px;
        background: linear-gradient(to right, rgba(146, 167, 154, 0.20) 0%, rgba(115, 147, 147, 0.31) 100%);
    }
    .chart{
        width:100%;
        margin: 10px auto;
    }
</style>



        <table>
            <tr>
                <th>View Statistics By: </th>
                <td align="center">
                    <select name="group" id="group">
                        <option value="Category">Category</option>
                        <option value="Department">Department</option>
                        <option value="Item">Item</option>
                        <option value="Staff">Staff</option>
                        <option value="Month">Month</option>
                        <option value="Year">Year</option>
                    </select>
                </td>
                <td align="center">
                    <button onclick="refresh()">View</button>
                </td>
            </tr>
            <tr>
                <th>Filter 1 : </th>
                <td align="center">
                    <select id="filter1" name="filter1">
                        <option>None</option>
                        <option value="Category">Category</option>
                        <option value="Department">Department</option>
                        <option value="Item">Item</option>
                        <option value="Staff">Staff</option>
                        <option value="Month">Month</option>
                        <option value="Year">Year</option>
                    </select>
                </td>
                <td align="center">
                    <select id="value1" name="value1" hidden>
                    </select>
                </td>
            </tr>
            <tr id="row2" hidden>
                <th>Filter 2 : </th>
                <td align="center">
                    <select id="filter2" name="filter2">
                    </select>
                </td>
                <td align="center">
                    <select id="value2" name="value2" hidden>
                    </select>
                </td>
            </tr>

        </table>
    


    <div id="chart-container">
        <img id="chart1" src=" @Url.Action("GenerateChartQty")" alt="Chart"  class="chart"/>
        <img id="chart2" src=" @Url.Action("GenerateChartCost")" alt="Chart"  class="chart"/>
        <img id="chart3" src=" @Url.Action("GenerateChartCount")" alt="Chart"  class="chart"/>
        

    </div>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script type="text/javascript">

    $('#filter1').change(function () {
        var filter1select = $("#filter1").val();
        var filter2 = $('#filter2');
        var values1 = $('#value1');
        var values2 = $('#value2');

        filter2.empty();

        if ( filter1select != null &&  filter1select != '') {
            $.getJSON('@Url.Action("GetFilter2")', { filter1:  filter1select }, function (descriptions) {
                if (descriptions != null && !jQuery.isEmptyObject(descriptions))
                {
                    filter2.append($('<option/>', {
                        value: null,
                        text: "None"
                    }));
                    $.each(descriptions, function (index, description) {
                        filter2.append($('<option/>', {
                            value: description.Value,
                            text: description.Text
                        }));
                    });
                };
            });
            values1.empty();
            values2.empty();
            $.getJSON('@Url.Action("GetFilterValues")', { filter:  filter1select }, function (descriptions) {
                if (descriptions != null && !jQuery.isEmptyObject(descriptions))
                {

                    $.each(descriptions, function (index, description) {
                        values1.append($('<option/>', {
                            value: description.Value,
                            text: description.Text
                        }));
                    });
                };
            });
        }

        var f1 = document.getElementById("filter1");
        var r2 = document.getElementById("row2");
        if (f1.value == "None") {
            document.getElementById("value1").hidden = true;
            r2.hidden = true;
        } else {
            document.getElementById("value1").hidden = false;
            r2.hidden = false;
        }
        document.getElementById("value2").hidden = true;
    });

    $('#filter2').change(function () {
        var filter2select = $("#filter2").val();
        var values2 = $('#value2');
        values2.empty();
        if (filter2select != null && filter2select != '') {
            $.getJSON('@Url.Action("GetFilterValues")', { filter: filter2select }, function (descriptions) {
                if (descriptions != null && !jQuery.isEmptyObject(descriptions)) {

                    $.each(descriptions, function (index, description) {
                        values2.append($('<option/>', {
                            value: description.Value,
                            text: description.Text
                        }));
                    });
                };
            });
        }
        var f2 = document.getElementById("filter2");
        if (f2.value == "None") {
            document.getElementById("value2").hidden = true;
        } else {
            document.getElementById("value2").hidden = false;
        }
    });
    </script>


    <script>
        function refresh() {

            var group = $("#group").val();
            var filter1 = $("#filter1").val();
            var filter2 = $("#filter2").val();
            var value1 = $("#value1").val();
            var value2 = $("#value2").val();

            $.ajax({
                url: " @Url.Action("Index","Analytics")",
                type: "POST",
                data: { group: group, filter1: filter1, filter2: filter2, value1: value1, value2: value2},
                datatype :"html",
                cache: false,
                success: function () {
                    //alert("success");
                }

            });

            $("#chart1").attr("src", "@Url.Action("GenerateChartQty")?" + new Date().getTime());
            $("#chart2").attr("src", "@Url.Action("GenerateChartCost")?" + new Date().getTime());
            $("#chart3").attr("src", "@Url.Action("GenerateChartCount")?" + new Date().getTime());
        }

        

    </script>
}
